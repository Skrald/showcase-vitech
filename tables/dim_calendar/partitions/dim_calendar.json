{
  "name": "dim_calendar",
  "mode": "import",
  "source": {
    "type": "m",
    "expression": [
      "let",
      "    params = [",
      "        CurrentDate = DateTime.FixedLocalNow(),",
      "        StartDate = Date.AddYears(Date.StartOfYear(CurrentDate), - 1),",
      "        EndDate = Date.AddYears(Date.EndOfYear(CurrentDate), 1),",
      "        DayCount = Duration.Days(Duration.From(EndDate - StartDate)) + 1,",
      "        Culture = \"en-GB\"",
      "    ],",
      "    dates = List.Dates(Date.From(params[StartDate]), params[DayCount], #duration(1, 0, 0, 0)),",
      "    transformed = List.Transform(",
      "        dates,",
      "        (dt) => {",
      "            dt,",
      "            Date.Year(dt),",
      "            Date.QuarterOfYear(dt),",
      "            Date.Year(dt) * 10 + Date.QuarterOfYear(dt),",
      "            Date.Month(dt),",
      "            Date.Year(dt) * 100 + Date.Month(dt),",
      "            Text.Start(Date.MonthName(dt, params[Culture]), 3), ",
      "            Date.Day(dt), ",
      "            Date.Year(dt) * 10000 + Date.Month(dt) * 100 + Date.Day(dt) ",
      "        }",
      "    ),",
      "    structure = {",
      "        {\"dt\", Date.Type},",
      "        {\"year\", Int64.Type},",
      "        {\"quarter\", Int64.Type},",
      "        {\"quarter_code\", Int64.Type},",
      "        {\"month\", Int64.Type},",
      "        {\"month_code\", Int64.Type},",
      "        {\"month_nm\", Text.Type}, ",
      "        {\"day\", Int64.Type},",
      "        {\"dt_code\", Int64.Type}",
      "    },",
      "    out = Table.TransformColumnTypes(",
      "        Table.FromRows(transformed, List.Transform(structure, each _{0})),",
      "        structure",
      "    )",
      "in",
      "    out"
    ]
  }
}